import{r as t,c as s,h as e,g as i}from"./p-0a7d63fb.js";const n=".query-field{display:flex;flex-direction:column;gap:0.5rem;font-family:sans-serif}.tags{display:flex;flex-wrap:wrap;gap:0.5rem}.tag{background-color:#1f4acd;color:white;padding:0.25rem 0.5rem;border-radius:1rem;display:inline-flex;align-items:center;gap:0.25rem;font-size:0.875rem}.remove-button{background:none;border:none;color:white;font-size:1rem;cursor:pointer}.input-wrapper{position:relative}.query-input{width:100%;padding:0.5rem;border:1px solid #ccc;border-radius:0.375rem;font-size:1rem;outline:none}.query-input:focus{border-color:#1f4acd}.context-menu{position:absolute;top:100%;left:0;background:#fff;border:1px solid #ccc;border-radius:0.375rem;box-shadow:0 2px 4px rgba(0, 0, 0, 0.1);width:100%;z-index:100;display:none;margin-top:0.25rem}.context-menu.visible{display:block}.suggestion{padding:0.5rem;cursor:pointer;font-size:0.9rem}.suggestion:hover{background-color:#f3f4f6}";const o=n;const a=class{constructor(e){t(this,e);this.queryChange=s(this,"queryChange",7);this.querySubmit=s(this,"querySubmit",7);this.handleOutsideClick=t=>{if(!this.hostElement.contains(t.target)){this.contextMenuVisible=false}};this.handleKeyDownEscape=t=>{if(t.key==="Escape"){this.contextMenuVisible=false}};this.filters=[];this.inputValue="";this.suggestions=[];this.currentStep="field";this.contextMenuVisible=false;this.fields=[];this.inputClass=undefined}componentWillLoad(){if(typeof this.fields==="string"){try{const t=JSON.parse(this.fields);if(Array.isArray(t)){this.fields=t}else{console.warn("Invalid fields prop: expected an array.");this.fields=[]}}catch(t){console.error("Error parsing fields prop:",t);this.fields=[]}}}componentDidLoad(){this.hiddenInput=document.createElement("input");this.hiddenInput.type="hidden";this.hiddenInput.name="query";this.hostElement.appendChild(this.hiddenInput);document.addEventListener("click",this.handleOutsideClick);document.addEventListener("keydown",this.handleKeyDownEscape)}disconnectedCallback(){document.removeEventListener("click",this.handleOutsideClick);document.removeEventListener("keydown",this.handleKeyDownEscape)}handleInputFocus(){this.updateSuggestions();this.contextMenuVisible=true}handleInputChange(t){this.inputValue=t.target.value;this.updateSuggestions()}handleKeyDown(t){if(t.key==="Enter"&&this.inputValue.trim()!==""){const t=this.validateInput(this.inputValue.trim());if(t){this.addFilter(this.inputValue.trim());this.inputValue="";this.contextMenuVisible=false;this.querySubmit.emit(this.getQueryValue())}else{alert("Invalid filter. Use format: field:operator:value")}}}handleSuggestionClick(t){const s=this.inputValue.split(":");if(this.currentStep==="field"){this.inputValue=`${t}:`}else if(this.currentStep==="operator"){this.inputValue=`${s[0]}:${t}:`}else if(this.currentStep==="value"){this.inputValue=`${s[0]}:${s[1]}:${t}`}this.updateSuggestions();this.inputRef.focus()}addFilter(t){const s=t.split(":");if(s.length===3){const[e,i,n]=s;const o=this.fields;const a=o.find((t=>t.name===e));if(a&&a.type==="string"){const s=`'${n.replace(/^'|'$/g,"")}'`;t=`${e}:${i}:${s}`}}this.filters=[...this.filters,t];this.emitQueryChange()}removeFilter(t){this.filters=this.filters.filter(((s,e)=>e!==t));this.emitQueryChange()}emitQueryChange(){const t=this.getQueryValue();this.queryChange.emit(t);if(this.hiddenInput){this.hiddenInput.value=t}}getQueryValue(){return this.filters.join(" ")}updateSuggestions(){const t=this.inputValue.split(":");const s=this.fields;if(t.length===1){this.currentStep="field";const e=t[0].toLowerCase();this.suggestions=s.map((t=>t.name)).filter((t=>e===""||t.toLowerCase().startsWith(e)))}else if(t.length===2){this.currentStep="operator";const e=s.find((s=>s.name===t[0]));if(e){this.suggestions=this.getOperatorsForType(e.type)}else{this.suggestions=[]}}else if(t.length===3){this.currentStep="value";const e=s.find((s=>s.name===t[0]));if(e){this.suggestions=this.getValuesForType(e.type)}else{this.suggestions=[]}}else{this.suggestions=[]}this.contextMenuVisible=this.suggestions.length>0}validateInput(t){const s=t.split(":");if(s.length===3){const[t,e,i]=s;const n=this.fields;const o=n.find((s=>s.name===t));if(!o)return false;if(!this.getOperatorsForType(o.type).includes(e))return false;return this.validateValueForType(i,o.type)}return false}getOperatorsForType(t){switch(t){case"string":return["LIKE","=","!=","null","notnull"];case"bool":return["=","null","notnull"];case"number":return[">","<",">=","<=","="];default:return[]}}getValuesForType(t){switch(t){case"string":return["test","example"];case"bool":return["true","false"];case"number":return["0","100","200"];default:return[]}}validateValueForType(t,s){switch(s){case"string":return typeof t==="string"&&t.trim()!=="";case"bool":return t==="true"||t==="false";case"number":return!isNaN(Number(t));default:return false}}render(){return e("div",{key:"744f9a2a56c8032f26b72b36037eea87c7662a5e",class:"query-field"},e("div",{key:"e4a9abcc7ed45db06bb51064a6e1a0cbf65b632c",class:"input-wrapper"},e("input",{key:"1f444207beed1370880b9f60292ac7a3cca28a6a",type:"text",ref:t=>this.inputRef=t,class:`query-input ${this.inputClass}`,value:this.inputValue,onFocus:()=>this.handleInputFocus(),onInput:t=>this.handleInputChange(t),onKeyDown:t=>this.handleKeyDown(t),placeholder:"Add filters (field:operator:value)"}),e("div",{key:"df25a92c460309f58c6c60016df749b2dd537f48",class:`context-menu ${this.contextMenuVisible?"visible":""}`},this.suggestions.map((t=>e("div",{class:"suggestion",onClick:()=>this.handleSuggestionClick(t)},t))))),e("div",{key:"8f442f109894d41bd1f7ee99b45b4feef200c0d6",class:"tags"},this.filters.map(((t,s)=>e("span",{class:"tag"},t,e("button",{type:"button",class:"remove-button",onClick:()=>this.removeFilter(s)},"Ã—"))))))}get hostElement(){return i(this)}};a.style=o;const r=".taxonomy-container{position:relative;display:inline-block;width:100%}.input-wrapper{position:relative}.taxonomy-input{width:100%;box-sizing:border-box;padding:8px;border:1px solid #ccc;border-radius:4px}.context-menu{position:absolute;top:100%;left:0;width:100%;box-sizing:border-box;border:1px solid #ccc;background:#fff;z-index:999;max-height:400px;overflow-y:auto;display:none}.context-menu.visible{display:block}.suggestion{padding:8px;cursor:pointer}.suggestion:hover{background:#eee}";const h=r;const c=class{constructor(e){t(this,e);this.valueChange=s(this,"valueChange",7);this.handleOutsideClick=t=>{const s=this.hostElement.shadowRoot;if(s&&!s.contains(t.target)){this.contextMenuVisible=false}};this.handleEscapeKey=t=>{if(t.key==="Escape"){this.contextMenuVisible=false}};this.url=undefined;this.name=undefined;this.value=undefined;this.inputValue="";this.suggestions=[];this.allData=[];this.contextMenuVisible=false}handleValueChange(t){this.valueChange.emit(t)}async componentWillLoad(){if(this.url){await this.fetchData()}if(this.value){this.inputValue=this.value}}componentDidLoad(){document.addEventListener("click",this.handleOutsideClick);document.addEventListener("keydown",this.handleEscapeKey)}disconnectedCallback(){document.removeEventListener("click",this.handleOutsideClick);document.removeEventListener("keydown",this.handleEscapeKey)}async fetchData(){try{const t=await fetch(this.url);const s=await t.text();this.allData=s.split("\n").map((t=>t.trim())).filter((t=>t!==""))}catch(t){console.error("Error fetching data:",t);this.allData=[]}}handleInputFocus(){if(this.inputValue.length>0){this.updateSuggestions(this.inputValue)}}handleInputChange(t){const s=t.target.value;this.inputValue=s;clearTimeout(this.debounceTimer);this.debounceTimer=window.setTimeout((()=>{this.updateSuggestions(s)}),100)}handleKeyDown(t){}handleSuggestionClick(t){this.inputValue=t;this.handleValueChange(t);this.inputRef.value=t;this.inputRef.focus()}updateSuggestions(t){if(t.trim().length===0){this.suggestions=[];this.contextMenuVisible=false}else{const s=t.toLowerCase();const e=this.allData.filter((t=>t.toLowerCase().includes(s)));this.suggestions=e.slice(0,100);this.contextMenuVisible=this.suggestions.length>0}}render(){return e("div",{key:"c22303a3fa7c19919445b3f01c98997bc1aa2fda",class:"taxonomy-container"},e("div",{key:"f1fcd0069fa59cdefa836aab7b717ee2433be2cc",class:"input-wrapper"},e("input",{key:"aa309ba56a1adfdce5be762ff5df5d1b070fe552",type:"text",ref:t=>this.inputRef=t,class:"taxonomy-input",name:this.name,value:this.inputValue,onFocus:()=>this.handleInputFocus(),onInput:t=>this.handleInputChange(t),onKeyDown:t=>this.handleKeyDown(t),placeholder:"Type to search..."}),e("div",{key:"dee9a4c610830c1841971be206201a7525abf618",class:`context-menu ${this.contextMenuVisible?"visible":""}`},this.suggestions.map((t=>e("div",{class:"suggestion",onClick:()=>this.handleSuggestionClick(t)},t))))))}get hostElement(){return i(this)}};c.style=h;const l=":host{display:inline-block;position:relative;width:300px;font-size:14px;font-family:sans-serif}.sc-textarea-container{position:relative;width:100%}.sc-textarea-input{width:100%;height:100px;box-sizing:border-box;padding:5px;border:1px solid #ccc;border-radius:4px;font:inherit}.sc-textarea-mirror{position:absolute;visibility:hidden;white-space:pre-wrap;word-wrap:break-word;overflow-wrap:break-word;top:0;left:0;z-index:-9999;font:inherit;line-height:normal;width:100%;padding:5px;border:1px solid transparent;box-sizing:border-box}.sc-textarea-suggestions{background:#fff;border:1px solid #ccc;border-radius:4px;margin:0;padding:0;list-style:none;max-height:200px;overflow-y:auto;z-index:999}.sc-textarea-suggestion-item{padding:5px 8px;cursor:pointer;font-size:14px;font-family:sans-serif}.sc-textarea-suggestion-item:hover,.sc-textarea-suggestion-item.highlighted{background-color:#eee}";const d=l;const f=class{constructor(s){t(this,s);this.suggestionUrl=undefined;this.textareaClass=undefined;this.suggestions=[];this.filteredSuggestions=[];this.showSuggestions=false;this.currentInputValue="";this.mentionStartIndex=-1;this.highlightIndex=0;this.caretCoords={top:0,left:0}}async componentWillLoad(){const t=await fetch(this.suggestionUrl);const s=await t.text();const e=s.split("\n").map((t=>t.trim())).filter((t=>t.length>0));this.suggestions=e.map((t=>({original:t,lower:t.toLowerCase()})))}handleKeyDown(t){if(!this.showSuggestions)return;if(t.key==="ArrowDown"){t.preventDefault();this.highlightIndex=(this.highlightIndex+1)%this.filteredSuggestions.length}else if(t.key==="ArrowUp"){t.preventDefault();this.highlightIndex=(this.highlightIndex-1+this.filteredSuggestions.length)%this.filteredSuggestions.length}else if(t.key==="Enter"){t.preventDefault();this.selectSuggestion(this.filteredSuggestions[this.highlightIndex])}else if(t.key==="Escape"){this.showSuggestions=false}}handleInput(t){const s=t.target;this.currentInputValue=s.value;const e=s.selectionStart;const i=s.value.substring(0,e);const n=i.lastIndexOf("@");if(n>-1){const t=i.substring(n+1).toLowerCase();const s=this.suggestions.filter((s=>s.lower.startsWith(t))).slice(0,10).map((t=>t.original));this.filteredSuggestions=s;this.showSuggestions=s.length>0;this.mentionStartIndex=n;this.highlightIndex=0}else{this.showSuggestions=false}this.updateMirror()}updateMirror(){if(!this.mirrorDiv||!this.textareaEl)return;const t=this.currentInputValue;const s=this.textareaEl.selectionStart;const e=t.substring(0,s);const i=t.substring(s);const n=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/> ");const o=n+'<span id="caret-marker">&#8203;</span>'+i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/> ");this.mirrorDiv.innerHTML=o;const a=this.mirrorDiv.querySelector("#caret-marker");if(a){const t=a.getBoundingClientRect();const s=this.el.shadowRoot.host.getBoundingClientRect();this.caretCoords={top:t.top-s.top,left:t.left-s.left}}}selectSuggestion(t){const s=this.currentInputValue;const e=s.substring(0,this.mentionStartIndex);const i=this.textareaEl.selectionStart;const n=s.substring(i);const o=e+"@"+t+" "+n;this.currentInputValue=o;this.showSuggestions=false;const a=(e+"@"+t+" ").length;this.textareaEl.value=o;this.textareaEl.setSelectionRange(a,a);this.textareaEl.focus();this.updateMirror()}componentDidLoad(){this.updateMirror()}render(){const{top:t,left:s}=this.caretCoords;return e("div",{key:"b4efd5704d2838593ca1346dc9c02525618495f0",class:"sc-textarea-container"},e("textarea",{key:"85884dbb3767a15b7e034ddc41d69dc9383b7a9e",ref:t=>this.textareaEl=t,value:this.currentInputValue,onInput:t=>this.handleInput(t),class:`sc-textarea-input ${this.textareaClass}`}),e("div",{key:"c94646c75200cfb00272a27f02fbf8ef411d3e57",class:"sc-textarea-mirror",ref:t=>this.mirrorDiv=t}),this.showSuggestions&&this.filteredSuggestions.length>0&&e("ul",{key:"3e691e4d03389a97f6a15bf8fab920de0f4b5288",class:"sc-textarea-suggestions",style:{position:"absolute",top:`${t+20}px`,left:`${s}px`},role:"listbox"},this.filteredSuggestions.map(((t,s)=>e("li",{class:{"sc-textarea-suggestion-item":true,highlighted:s===this.highlightIndex},role:"option",onClick:()=>this.selectSuggestion(t),onMouseOver:()=>this.highlightIndex=s},t)))))}get el(){return i(this)}};f.style=d;export{a as sc_query_field,c as sc_taxonomy,f as sc_textarea};
//# sourceMappingURL=p-09607273.entry.js.map