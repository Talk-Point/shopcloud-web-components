import{r as t,c as e,h as s,g as i}from"./p-HM8ZyJ4I.js";const o=".query-field{display:flex;flex-direction:column;gap:0.5rem;font-family:sans-serif}.tags{display:flex;flex-wrap:wrap;gap:0.5rem}.tag{background-color:#1f4acd;color:white;padding:0.25rem 0.5rem;border-radius:1rem;display:inline-flex;align-items:center;gap:0.25rem;font-size:0.875rem}.remove-button{background:none;border:none;color:white;font-size:1rem;cursor:pointer}.input-wrapper{position:relative}.query-input{width:100%;padding:0.5rem;border:1px solid #ccc;border-radius:0.375rem;font-size:1rem;outline:none}.query-input:focus{border-color:#1f4acd}.context-menu{position:absolute;top:100%;left:0;background:#fff;border:1px solid #ccc;border-radius:0.375rem;box-shadow:0 2px 4px rgba(0, 0, 0, 0.1);width:100%;z-index:100;display:none;margin-top:0.25rem}.context-menu.visible{display:block}.suggestion{padding:0.5rem;cursor:pointer;font-size:0.9rem}.suggestion:hover{background-color:#f3f4f6}";const r=class{constructor(s){t(this,s);this.queryChange=e(this,"queryChange");this.querySubmit=e(this,"querySubmit");this.filters=[];this.inputValue="";this.suggestions=[];this.currentStep="field";this.contextMenuVisible=false;this.fields=[];this.handleOutsideClick=t=>{if(!this.hostElement.contains(t.target)){this.contextMenuVisible=false}};this.handleKeyDownEscape=t=>{if(t.key==="Escape"){this.contextMenuVisible=false}}}componentWillLoad(){if(typeof this.fields==="string"){try{const t=JSON.parse(this.fields);if(Array.isArray(t)){this.fields=t}else{console.warn("Invalid fields prop: expected an array.");this.fields=[]}}catch(t){console.error("Error parsing fields prop:",t);this.fields=[]}}}componentDidLoad(){this.hiddenInput=document.createElement("input");this.hiddenInput.type="hidden";this.hiddenInput.name="query";this.hostElement.appendChild(this.hiddenInput);document.addEventListener("click",this.handleOutsideClick);document.addEventListener("keydown",this.handleKeyDownEscape)}disconnectedCallback(){document.removeEventListener("click",this.handleOutsideClick);document.removeEventListener("keydown",this.handleKeyDownEscape)}handleInputFocus(){this.updateSuggestions();this.contextMenuVisible=true}handleInputChange(t){this.inputValue=t.target.value;this.updateSuggestions()}handleKeyDown(t){if(t.key==="Enter"&&this.inputValue.trim()!==""){const t=this.validateInput(this.inputValue.trim());if(t){this.addFilter(this.inputValue.trim());this.inputValue="";this.contextMenuVisible=false;this.querySubmit.emit(this.getQueryValue())}else{alert("Invalid filter. Use format: field:operator:value")}}}handleSuggestionClick(t){const e=this.inputValue.split(":");if(this.currentStep==="field"){this.inputValue=`${t}:`}else if(this.currentStep==="operator"){this.inputValue=`${e[0]}:${t}:`}else if(this.currentStep==="value"){this.inputValue=`${e[0]}:${e[1]}:${t}`}this.updateSuggestions();this.inputRef.focus()}addFilter(t){const e=t.split(":");if(e.length===3){const[s,i,o]=e;const r=this.fields;const n=r.find((t=>t.name===s));if(n&&n.type==="string"){const e=`'${o.replace(/^'|'$/g,"")}'`;t=`${s}:${i}:${e}`}}this.filters=[...this.filters,t];this.emitQueryChange()}removeFilter(t){this.filters=this.filters.filter(((e,s)=>s!==t));this.emitQueryChange()}emitQueryChange(){const t=this.getQueryValue();this.queryChange.emit(t);if(this.hiddenInput){this.hiddenInput.value=t}}getQueryValue(){return this.filters.join(" ")}updateSuggestions(){const t=this.inputValue.split(":");const e=this.fields;if(t.length===1){this.currentStep="field";const s=t[0].toLowerCase();this.suggestions=e.map((t=>t.name)).filter((t=>s===""||t.toLowerCase().startsWith(s)))}else if(t.length===2){this.currentStep="operator";const s=e.find((e=>e.name===t[0]));if(s){this.suggestions=this.getOperatorsForType(s.type)}else{this.suggestions=[]}}else if(t.length===3){this.currentStep="value";const s=e.find((e=>e.name===t[0]));if(s){this.suggestions=this.getValuesForType(s.type)}else{this.suggestions=[]}}else{this.suggestions=[]}this.contextMenuVisible=this.suggestions.length>0}validateInput(t){const e=t.split(":");if(e.length===3){const[t,s,i]=e;const o=this.fields;const r=o.find((e=>e.name===t));if(!r)return false;if(!this.getOperatorsForType(r.type).includes(s))return false;return this.validateValueForType(i,r.type)}return false}getOperatorsForType(t){switch(t){case"string":return["LIKE","=","!=","null","notnull"];case"bool":return["=","null","notnull"];case"number":return[">","<",">=","<=","="];default:return[]}}getValuesForType(t){switch(t){case"string":return["test","example"];case"bool":return["true","false"];case"number":return["0","100","200"];default:return[]}}validateValueForType(t,e){switch(e){case"string":return typeof t==="string"&&t.trim()!=="";case"bool":return t==="true"||t==="false";case"number":return!isNaN(Number(t));default:return false}}render(){return s("div",{key:"744f9a2a56c8032f26b72b36037eea87c7662a5e",class:"query-field"},s("div",{key:"e4a9abcc7ed45db06bb51064a6e1a0cbf65b632c",class:"input-wrapper"},s("input",{key:"1f444207beed1370880b9f60292ac7a3cca28a6a",type:"text",ref:t=>this.inputRef=t,class:`query-input ${this.inputClass}`,value:this.inputValue,onFocus:()=>this.handleInputFocus(),onInput:t=>this.handleInputChange(t),onKeyDown:t=>this.handleKeyDown(t),placeholder:"Add filters (field:operator:value)"}),s("div",{key:"df25a92c460309f58c6c60016df749b2dd537f48",class:`context-menu ${this.contextMenuVisible?"visible":""}`},this.suggestions.map((t=>s("div",{class:"suggestion",onClick:()=>this.handleSuggestionClick(t)},t))))),s("div",{key:"8f442f109894d41bd1f7ee99b45b4feef200c0d6",class:"tags"},this.filters.map(((t,e)=>s("span",{class:"tag"},t,s("button",{type:"button",class:"remove-button",onClick:()=>this.removeFilter(e)},"Ã—"))))))}get hostElement(){return i(this)}};r.style=o;const n=":host{--background-color:#ffffff;--text-color:#333333;--border-color:#cccccc;--input-background:#ffffff;--row-border:#eeeeee;--button-background:#007bff;--button-color:#ffffff;--button-disabled-background:#cccccc;--button-disabled-color:#666666;--error-color:#dc3545;--success-color:#28a745;--pending-color:#ffd700;--reference-background:#f8f9fa;--reference-color:#495057}@media (prefers-color-scheme: dark){:host{--background-color:#1a1a1a;--text-color:#e0e0e0;--border-color:#404040;--input-background:#2d2d2d;--row-border:#333333;--button-background:#0056b3;--button-color:#ffffff;--button-disabled-background:#404040;--button-disabled-color:#808080;--error-color:#ff4d4d;--success-color:#2fb344;--pending-color:#ffd700;--reference-background:#2d2d2d;--reference-color:#b8b8b8}}.container{padding:20px;font-family:system-ui, -apple-system, sans-serif;background-color:var(--background-color);color:var(--text-color)}.input-section{margin-bottom:20px}.button-group{display:flex;gap:10px}textarea{width:100%;margin-bottom:10px;padding:10px;border:1px solid var(--border-color);border-radius:4px;background-color:var(--input-background);color:var(--text-color)}textarea:focus{outline:none;border-color:var(--button-background);box-shadow:0 0 0 2px rgba(0, 123, 255, 0.25)}button{padding:10px 20px;background-color:var(--button-background);color:var(--button-color);border:none;border-radius:4px;cursor:pointer;transition:background-color 0.2s ease}button:hover:not(:disabled){background-color:color-mix(in srgb, var(--button-background) 85%, black)}button:disabled{background-color:var(--button-disabled-background);color:var(--button-disabled-color);cursor:not-allowed}.data-grid{margin-top:20px}.row{display:flex;align-items:center;padding:10px;border:1px solid var(--row-border);margin-bottom:5px;border-radius:4px;transition:background-color 0.2s ease}.row:hover{background-color:color-mix(in srgb, var(--background-color) 95%, var(--text-color))}.status-indicator{width:10px;height:10px;border-radius:50%;margin-right:10px;flex-shrink:0}.row.pending .status-indicator{background-color:var(--pending-color)}.row.success .status-indicator{background-color:var(--success-color)}.row.error .status-indicator{background-color:var(--error-color)}.row-data{flex:1;display:flex;flex-wrap:wrap;gap:10px}.row-data span{padding:2px 6px;border-radius:3px;background-color:color-mix(in srgb, var(--background-color) 97%, var(--text-color))}span.reference{background-color:var(--reference-background);color:var(--reference-color);padding:2px 8px;border-radius:4px;border:1px solid var(--border-color);font-weight:500}.error-message{color:var(--error-color);margin-left:10px;font-size:0.9em;flex-basis:100%;margin-top:5px}";const a=class{constructor(e){t(this,e);this.storageKey="spreadsheet-data";this.apiUrl="";this.apiMethod="POST";this.apiHeaders="{}";this.parsedData=[];this.isProcessing=false;this.parseInput=()=>{const t=this.textArea.value;const e=t.trim().split("\n");const s=e[0].split("\t");const i=e.slice(1).map(((t,e)=>{const i=t.split("\t");const o={};s.forEach(((t,e)=>{var s;o[t.trim()]=((s=i[e])===null||s===void 0?void 0:s.trim())||""}));return{id:`row-${e}`,data:o,status:"pending"}}));this.parsedData=i;this.saveToLocalStorage()};this.saveToLocalStorage=()=>{localStorage.setItem(this.storageKey,JSON.stringify(this.parsedData))};this.clearData=()=>{this.parsedData=[];localStorage.removeItem(this.storageKey);this.textArea.value=""}}getHeaders(){try{return Object.assign({"Content-Type":"application/json"},JSON.parse(this.apiHeaders))}catch(t){console.warn("Invalid apiHeaders format, using default headers");return{"Content-Type":"application/json"}}}componentWillLoad(){const t=localStorage.getItem(this.storageKey);if(t){this.parsedData=JSON.parse(t)}}async processData(){if(!this.apiUrl){throw new Error("API URL ist nicht konfiguriert")}this.isProcessing=true;for(const t of this.parsedData){if(t.status==="success")continue;try{const e=await this.sendToAPI(t.data);t.status="success";t.errorMessage=undefined;if(e&&e.reference){t.reference=e.reference}}catch(e){t.status="error";t.errorMessage=e.message}this.parsedData=[...this.parsedData];this.saveToLocalStorage()}this.isProcessing=false}async sendToAPI(t){try{const e=await fetch(this.apiUrl,{method:this.apiMethod,headers:this.getHeaders(),body:JSON.stringify(t)});if(e.status!==200&&e.status!==201){throw new Error(`HTTP error! status: ${e.status}`)}const s=await e.text();if(!s){return{}}return JSON.parse(s)}catch(t){throw new Error(`API-Fehler: ${t.message}`)}}render(){return s("div",{key:"ef2ffc23c7174b3fad4ab73262ece9663d0a2536",class:"container"},s("div",{key:"2c0abbe9dcaf26b9501291e97359d88ca373d68e",class:"input-section"},s("textarea",{key:"b7bb8a74d3663a482f6f4271312b3b16471233fc",ref:t=>this.textArea=t,placeholder:"FÃ¼ge hier deine Tabellendaten ein...",rows:10}),s("div",{key:"754fc0514298256708a359f1f91ae7686e64f7d4",class:"button-group"},s("button",{key:"e794825c20386410897476c441059c9f3b638015",onClick:this.parseInput,disabled:this.isProcessing},"Daten einlesen"),s("button",{key:"e276f13e795f845e191cbf203eecfa0ebb9a3ef0",onClick:this.clearData,disabled:this.isProcessing},"ZurÃ¼cksetzen"))),this.parsedData.length>0&&s("div",{key:"de69162c9cf39f8950ff480a9008d33b2620169d",class:"data-section"},s("button",{key:"662d0e94bd0990d237dce6933903adde03b944c6",onClick:()=>this.processData(),disabled:this.isProcessing||!this.apiUrl},this.isProcessing?"Verarbeite...":"An API senden"),s("div",{key:"593df1ffc1bf6061458b0524fe7ca222c1ec52b8",class:"data-grid"},this.parsedData.map((t=>s("div",{class:`row ${t.status}`,key:t.id},s("div",{class:"status-indicator"}),s("div",{class:"row-data"},Object.entries(t.data).map((([t,e])=>s("span",{key:t},t,": ",e))),t.reference&&s("span",{class:"reference"},"Referenz: ",t.reference)),t.errorMessage&&s("div",{class:"error-message"},t.errorMessage)))))))}};a.style=n;const c=".taxonomy-container{position:relative;display:inline-block;width:100%}.input-wrapper{position:relative}.taxonomy-input{width:100%;box-sizing:border-box;padding:8px;border:1px solid #ccc;border-radius:4px}.context-menu{position:absolute;top:100%;left:0;width:100%;box-sizing:border-box;border:1px solid #ccc;background:#fff;z-index:999;max-height:400px;overflow-y:auto;display:none}.context-menu.visible{display:block}.suggestion{padding:8px;cursor:pointer}.suggestion:hover{background:#eee}";const d=class{constructor(s){t(this,s);this.valueChange=e(this,"valueChange");this.inputValue="";this.suggestions=[];this.allData=[];this.contextMenuVisible=false;this.handleOutsideClick=t=>{const e=this.hostElement.shadowRoot;if(e&&!e.contains(t.target)){this.contextMenuVisible=false}};this.handleEscapeKey=t=>{if(t.key==="Escape"){this.contextMenuVisible=false}}}handleValueChange(t){this.valueChange.emit(t)}async componentWillLoad(){if(this.url){await this.fetchData()}if(this.value){this.inputValue=this.value}}componentDidLoad(){document.addEventListener("click",this.handleOutsideClick);document.addEventListener("keydown",this.handleEscapeKey)}disconnectedCallback(){document.removeEventListener("click",this.handleOutsideClick);document.removeEventListener("keydown",this.handleEscapeKey)}async fetchData(){try{const t=await fetch(this.url);const e=await t.text();this.allData=e.split("\n").map((t=>t.trim())).filter((t=>t!==""))}catch(t){console.error("Error fetching data:",t);this.allData=[]}}handleInputFocus(){if(this.inputValue.length>0){this.updateSuggestions(this.inputValue)}}handleInputChange(t){const e=t.target.value;this.inputValue=e;clearTimeout(this.debounceTimer);this.debounceTimer=window.setTimeout((()=>{this.updateSuggestions(e)}),100)}handleKeyDown(t){}handleSuggestionClick(t){this.inputValue=t;this.handleValueChange(t);this.inputRef.value=t;this.inputRef.focus()}updateSuggestions(t){if(t.trim().length===0){this.suggestions=[];this.contextMenuVisible=false}else{const e=t.toLowerCase();const s=this.allData.filter((t=>t.toLowerCase().includes(e)));this.suggestions=s.slice(0,100);this.contextMenuVisible=this.suggestions.length>0}}render(){return s("div",{key:"d12a2c41383c8a99fd50826477da03079b66876f",class:"taxonomy-container"},s("div",{key:"73ecb465a2ef793490d218b519066ef38f7fe21c",class:"input-wrapper"},s("input",{key:"a5ff63c6a54b432ce7c12ba09fcf7c43bd35ee98",type:"text",ref:t=>this.inputRef=t,class:"taxonomy-input",name:this.name,value:this.inputValue,onFocus:()=>this.handleInputFocus(),onInput:t=>this.handleInputChange(t),onKeyDown:t=>this.handleKeyDown(t),placeholder:"Type to search..."}),s("div",{key:"fcf750dfdbdfa37efc55faac9346550cbee2385e",class:`context-menu ${this.contextMenuVisible?"visible":""}`},this.suggestions.map((t=>s("div",{class:"suggestion",onClick:()=>this.handleSuggestionClick(t)},t))))))}get hostElement(){return i(this)}};d.style=c;const l=":host{display:inline-block;position:relative;width:300px;font-size:14px;font-family:sans-serif}.sc-textarea-container{position:relative;width:100%}.sc-textarea-input{width:100%;height:100px;box-sizing:border-box;padding:5px;border:1px solid #ccc;border-radius:4px;font:inherit}.sc-textarea-mirror{position:absolute;visibility:hidden;white-space:pre-wrap;word-wrap:break-word;overflow-wrap:break-word;top:0;left:0;z-index:-9999;font:inherit;line-height:normal;width:100%;padding:5px;border:1px solid transparent;box-sizing:border-box}.sc-textarea-suggestions{background:#fff;border:1px solid #ccc;border-radius:4px;margin:0;padding:0;list-style:none;max-height:200px;overflow-y:auto;z-index:999}.sc-textarea-suggestion-item{padding:5px 8px;cursor:pointer;font-size:14px;font-family:sans-serif}.sc-textarea-suggestion-item:hover,.sc-textarea-suggestion-item.highlighted{background-color:#eee}";const h=class{constructor(e){t(this,e);this.suggestions=[];this.filteredSuggestions=[];this.showSuggestions=false;this.currentInputValue="";this.mentionStartIndex=-1;this.highlightIndex=0;this.caretCoords={top:0,left:0}}async componentWillLoad(){const t=await fetch(this.suggestionUrl);const e=await t.text();const s=e.split("\n").map((t=>t.trim())).filter((t=>t.length>0));this.suggestions=s.map((t=>({original:t,lower:t.toLowerCase()})))}handleKeyDown(t){if(!this.showSuggestions)return;if(t.key==="ArrowDown"){t.preventDefault();this.highlightIndex=(this.highlightIndex+1)%this.filteredSuggestions.length}else if(t.key==="ArrowUp"){t.preventDefault();this.highlightIndex=(this.highlightIndex-1+this.filteredSuggestions.length)%this.filteredSuggestions.length}else if(t.key==="Enter"){t.preventDefault();this.selectSuggestion(this.filteredSuggestions[this.highlightIndex])}else if(t.key==="Escape"){this.showSuggestions=false}}handleInput(t){const e=t.target;this.currentInputValue=e.value;const s=e.selectionStart;const i=e.value.substring(0,s);const o=i.lastIndexOf("@");if(o>-1){const t=i.substring(o+1).toLowerCase();const e=this.suggestions.filter((e=>e.lower.startsWith(t))).slice(0,10).map((t=>t.original));this.filteredSuggestions=e;this.showSuggestions=e.length>0;this.mentionStartIndex=o;this.highlightIndex=0}else{this.showSuggestions=false}this.updateMirror()}updateMirror(){if(!this.mirrorDiv||!this.textareaEl)return;const t=this.currentInputValue;const e=this.textareaEl.selectionStart;const s=t.substring(0,e);const i=t.substring(e);const o=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/> ");const r=o+'<span id="caret-marker">&#8203;</span>'+i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/> ");this.mirrorDiv.innerHTML=r;const n=this.mirrorDiv.querySelector("#caret-marker");if(n){const t=n.getBoundingClientRect();const e=this.el.shadowRoot.host.getBoundingClientRect();this.caretCoords={top:t.top-e.top,left:t.left-e.left}}}selectSuggestion(t){const e=this.currentInputValue;const s=e.substring(0,this.mentionStartIndex);const i=this.textareaEl.selectionStart;const o=e.substring(i);const r=s+"@"+t+" "+o;this.currentInputValue=r;this.showSuggestions=false;const n=(s+"@"+t+" ").length;this.textareaEl.value=r;this.textareaEl.setSelectionRange(n,n);this.textareaEl.focus();this.updateMirror()}componentDidLoad(){this.updateMirror()}render(){const{top:t,left:e}=this.caretCoords;return s("div",{key:"b4619cca189b2e3e2fe91ea351235730c17dc9ee",class:"sc-textarea-container"},s("textarea",{key:"5884b3422df45bacf9b3af1696a744e16e901114",ref:t=>this.textareaEl=t,value:this.currentInputValue,onInput:t=>this.handleInput(t),class:`sc-textarea-input ${this.textareaClass}`}),s("div",{key:"4cda706eeee1c217a0deed54ff3f64348704bfbb",class:"sc-textarea-mirror",ref:t=>this.mirrorDiv=t}),this.showSuggestions&&this.filteredSuggestions.length>0&&s("ul",{key:"7eb98c878d5256375d20158a1e597ea201ee2bf5",class:"sc-textarea-suggestions",style:{position:"absolute",top:`${t+20}px`,left:`${e}px`},role:"listbox"},this.filteredSuggestions.map(((t,e)=>s("li",{class:{"sc-textarea-suggestion-item":true,highlighted:e===this.highlightIndex},role:"option",onClick:()=>this.selectSuggestion(t),onMouseOver:()=>this.highlightIndex=e},t)))))}get el(){return i(this)}};h.style=l;export{r as sc_query_field,a as sc_spreadsheet_uploader,d as sc_taxonomy,h as sc_textarea};
//# sourceMappingURL=p-efff00dc.entry.js.map